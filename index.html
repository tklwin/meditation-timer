<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timer</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #ffffff;
    --text: #37352f;
    --soft: #9b9a97;
    --softer: #e9e9e7;
    --hover-bg: #f1f1ef;
    --danger: #eb5757;
    --radius: 6px;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
  }

  #flash {
    position: fixed; inset: 0;
    background: #ffecec;
    opacity: 0;
    pointer-events: none;
    z-index: 100;
    transition: opacity 0.08s;
  }
  #flash.on { opacity: 1; }

  .container {
    width: 100%;
    max-width: 300px;
    padding: 2rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .time-text {
    font-size: 80px;
    font-weight: 600;
    letter-spacing: -4px;
    line-height: 1;
    color: var(--text);
    transition: color 0.3s;
    font-variant-numeric: tabular-nums;
    margin-bottom: 6px;
  }
  .time-text.danger { color: var(--danger); }

  .time-status {
    font-size: 12px;
    color: var(--soft);
    margin-bottom: 20px;
    height: 16px;
  }

  .progress-bar-wrap {
    width: 100%;
    height: 2px;
    background: var(--softer);
    border-radius: 2px;
    margin-bottom: 24px;
    overflow: hidden;
  }
  .progress-bar {
    height: 100%;
    background: var(--text);
    border-radius: 2px;
    width: 100%;
    transition: width 1s linear, background 0.3s;
  }
  .progress-bar.danger { background: var(--danger); }

  .presets {
    display: flex;
    gap: 4px;
    margin-bottom: 16px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .preset {
    padding: 3px 10px;
    border-radius: var(--radius);
    border: 1px solid var(--softer);
    background: none;
    font-family: inherit;
    font-size: 12px;
    color: var(--soft);
    cursor: pointer;
    transition: background 0.1s, color 0.1s;
  }
  .preset:hover:not(.locked) { background: var(--hover-bg); color: var(--text); }
  .preset.active { background: var(--hover-bg); border-color: transparent; color: var(--text); font-weight: 500; }
  .preset.locked { pointer-events: none; opacity: 0.35; }

  .duration-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 24px;
  }
  .dur-btn {
    width: 26px; height: 26px;
    border-radius: var(--radius);
    border: 1px solid var(--softer);
    background: none;
    cursor: pointer;
    font-size: 15px;
    color: var(--soft);
    display: flex; align-items: center; justify-content: center;
    transition: background 0.1s, color 0.1s;
    font-family: inherit;
  }
  .dur-btn:hover:not(:disabled) { background: var(--hover-bg); color: var(--text); }
  .dur-btn:disabled { opacity: 0.3; cursor: default; }

  .dur-value {
    font-size: 13px;
    color: var(--text);
    min-width: 44px;
    text-align: center;
    font-weight: 500;
  }

  .controls { display: flex; gap: 8px; }

  .btn {
    padding: 6px 16px;
    border-radius: var(--radius);
    border: 1px solid var(--softer);
    font-family: inherit;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.1s, color 0.1s;
    min-width: 76px;
  }
  .btn-primary { background: var(--text); color: #fff; border-color: var(--text); }
  .btn-primary:hover { background: #1a1915; }
  .btn-primary.red { background: var(--danger); border-color: var(--danger); }
  .btn-ghost { background: none; color: var(--soft); }
  .btn-ghost:hover { background: var(--hover-bg); color: var(--text); }

  .done-msg {
    margin-top: 14px;
    font-size: 12px;
    color: var(--soft);
    opacity: 0;
    transition: opacity 0.5s;
    height: 16px;
  }
  .done-msg.show { opacity: 1; }
</style>
</head>
<body>
<div id="flash"></div>
<div class="container">
  <div class="time-text" id="timeText">5:00</div>
  <div class="time-status" id="timeSub">Ready</div>

  <div class="progress-bar-wrap">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div class="presets" id="presetRow">
    <button class="preset" data-min="1">1m</button>
    <button class="preset" data-min="2">2m</button>
    <button class="preset" data-min="3">3m</button>
    <button class="preset active" data-min="5">5m</button>
    <button class="preset" data-min="10">10m</button>
    <button class="preset" data-min="30">30m</button>

  </div>

  <div class="duration-row">
    <button class="dur-btn" id="durDown">−</button>
    <span class="dur-value" id="durValue">5 min</span>
    <button class="dur-btn" id="durUp">+</button>
  </div>

  <div class="controls">
    <button class="btn btn-ghost" id="resetBtn">Reset</button>
    <button class="btn btn-primary" id="startBtn">Start</button>
  </div>

  <div class="done-msg" id="doneMsg">Time's up</div>
</div>

<script>
  let totalSeconds = 5 * 60;
  let remaining = totalSeconds;
  let running = false;
  let ticker = null;

  const timeText    = document.getElementById('timeText');
  const timeSub     = document.getElementById('timeSub');
  const progressBar = document.getElementById('progressBar');
  const startBtn    = document.getElementById('startBtn');
  const resetBtn    = document.getElementById('resetBtn');
  const durDown     = document.getElementById('durDown');
  const durUp       = document.getElementById('durUp');
  const durValue    = document.getElementById('durValue');
  const doneMsg     = document.getElementById('doneMsg');
  const flash       = document.getElementById('flash');
  const presets     = document.querySelectorAll('.preset');

  const fmt = s => `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;

  function playChime() {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      [[523.25,0],[659.25,0.22],[783.99,0.44]].forEach(([freq,delay]) => {
        const osc = ctx.createOscillator(), gain = ctx.createGain();
        osc.type = 'sine'; osc.frequency.value = freq;
        const t = ctx.currentTime + delay;
        gain.gain.setValueAtTime(0,t);
        gain.gain.linearRampToValueAtTime(0.25, t+0.015);
        gain.gain.exponentialRampToValueAtTime(0.001, t+2.0);
        osc.connect(gain); gain.connect(ctx.destination);
        osc.start(t); osc.stop(t+2.2);
      });
    } catch(e){}
  }

  function doFlash() {
    let n=0;
    const go = () => {
      flash.classList.add('on');
      setTimeout(()=>{ flash.classList.remove('on'); if(++n<3) setTimeout(go,380); },160);
    };
    go();
  }

  function render() {
    const idle   = !running && remaining === totalSeconds;
    const danger = remaining <= 30 && !idle;
    const done   = remaining === 0;

    timeText.textContent = fmt(remaining);
    timeText.classList.toggle('danger', danger || done);
    progressBar.style.width = (remaining / totalSeconds * 100) + '%';
    progressBar.classList.toggle('danger', danger || done);

    timeSub.textContent = idle ? 'Ready' : running ? 'Running…' : done ? 'Done' : 'Paused';
    startBtn.textContent = running ? 'Pause' : (remaining < totalSeconds && remaining > 0 ? 'Resume' : 'Start');
    startBtn.classList.toggle('red', danger && running);

    const locked = running || remaining !== totalSeconds;
    durDown.disabled = locked;
    durUp.disabled   = locked;
    presets.forEach(p => p.classList.toggle('locked', locked));
  }

  function finish() {
    clearInterval(ticker); running = false; remaining = 0;
    render(); playChime(); doFlash();
    doneMsg.classList.add('show');
  }

  function tick() {
    if (remaining <= 0) { finish(); return; }
    remaining--;
    render();
    if (remaining === 0) finish();
  }

  startBtn.addEventListener('click', () => {
    if (remaining === 0) return;
    if (!running) {
      running = true;
      doneMsg.classList.remove('show');
      ticker = setInterval(tick, 1000);
    } else {
      running = false; clearInterval(ticker);
    }
    render();
  });

  resetBtn.addEventListener('click', () => {
    clearInterval(ticker); running = false; remaining = totalSeconds;
    doneMsg.classList.remove('show'); render();
  });

  function setDuration(mins) {
    clearInterval(ticker); running = false;
    totalSeconds = mins * 60; remaining = totalSeconds;
    doneMsg.classList.remove('show');
    durValue.textContent = `${mins} min`;
    presets.forEach(p => p.classList.toggle('active', parseInt(p.dataset.min) === mins));
    render();
  }

  durDown.addEventListener('click', () => { const c=totalSeconds/60; if(c>1) setDuration(c-1); });
  durUp.addEventListener('click',   () => { const c=totalSeconds/60; if(c<60) setDuration(c+1); });
  presets.forEach(p => p.addEventListener('click', () => setDuration(parseInt(p.dataset.min))));

  setDuration(5);
</script>
</body>
</html>
